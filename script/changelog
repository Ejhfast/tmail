#!/usr/bin/env ratch

# generate changelogs

file = 'log/History.txt'
out  = 'log/Release.txt'

name, version = *File.basename(glob("meta/*.roll").first).chomp('.roll').split('-')

main :changelog => [:recent] do
  mkdir_p "doc/log"
  svn "log --xml > doc/log/changelog.xml"
end

task :recent do
  changes = /^===\s*#{version}(.*?)\n===/m.match(File.read(file))[0]
  changes = changes.chomp('===').strip.sub(/^===\s+/, 'TAG ')
  File.open(out, 'w'){ |f| f << changes }
end
