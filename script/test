#!/usr/bin/env ratch

# Run unit tests

main :test do
  $LOAD_PATH.unshift('test')

  find = commandline[0]
  live = commandline.flag?('--live')
  pure = commandline.flag?('--pure')  # pure won't work if live.

  ARGV.replace([]) # ???

  unless live
    $LOAD_PATH.unshift(File.expand_path('lib'))
    $LOAD_PATH.unshift(File.expand_path('ext/mailscanner')) unless pure
  end

  if find
    unless file?(find)
      find = File.join(find, '**', 'test_*.rb')
    end
  else
    find = 'test/**/test_*.rb'
  end

  files = Dir.glob(find) #.map{ |f| File.join('..', f) }

  #chdir('test') do
    files.each do |file|
      next unless file?(file)
      load file
    end
  #end
end

