#!/usr/bin/env ratch

# Run unit tests

main :test do
  $LOAD_PATH.unshift('test')

  live = commandline.flag?('--live')

  unless live
    $LOAD_PATH.unshift(File.expand_path('lib'))
    $LOAD_PATH.unshift(File.expand_path('ext/base64_c'))
    $LOAD_PATH.unshift(File.expand_path('ext/scanner_c'))
  end

  if find = commandline[0]
    unless file?(find)
      find = File.join(find, '**', 'test_*.rb')
    end
  else
    find = 'test/**/test_*.rb'
  end

  files = Dir.glob(find) #.map{ |f| File.join('..', f) }

  #chdir('test') do
    files.each do |file|
      next unless file?(file)
      load file
    end
  #end
end

