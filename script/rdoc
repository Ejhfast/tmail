#!/usr/bin/env ratch

# generate rdocs
#
# Generate Rdoc documentation. Settings are
# the same as the rdoc command's options.

main :rdoc do
  # Load rdoc configuration.

  config = configuration['rdoc']

  config['op'] = config.delete('output') if config['output']

  config = {
    'template'       => 'html',
    'op'             => 'doc/rdoc',
    'merge'          => true,
    'inline-source'  => true,
    'exclude'        => %w{MANIFEST, Manifest.txt},
    'include'        => %w{[A-Z]* lib ext}
  }.update(config)

  output = config['op']

  # Check for parent directory.
  # (Helps to ensure we're in the right place.)

  dir!(File.dirname(output))

  # Prepare command arguments.

  vector = config.command_vector('include')

  # Remove old rdocs, if any.

  rm_r(output) if File.exist?(output)

  # Document.

  rdoc(*vector)
end
